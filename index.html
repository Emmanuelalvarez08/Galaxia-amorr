<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover" />
<title>Para Diana ðŸ’–</title>

<style>
  :root{
    /* Estos valores los setea JS con base en el iPhone */
    --mediaW: 120px;   /* ancho fotos/videos */
    --textSize: 18px;  /* tamaÃ±o frases */
    --counterSize: 14px;
    --padSafeTop: env(safe-area-inset-top, 0px);
  }

  body{
    margin:0;
    overflow:hidden;
    background:#000;
    font-family:Arial, sans-serif;
    color:white;
    text-align:center;
    -webkit-text-size-adjust: 100%;
    touch-action: manipulation;
  }

  canvas{ position:fixed; inset:0; }
  #heartsCanvas{ z-index:0; }
  #galaxy{ z-index:1; }

  #surpriseLayer{
    position:fixed;
    inset:0;
    z-index:5;
    pointer-events:none;
  }

  /* CONTADOR */
  #loveCounter{
    position:fixed;
    top: calc(10px + var(--padSafeTop));
    left:50%;
    transform:translateX(-50%);
    padding:8px 12px;
    border-radius:16px;
    background:rgba(0,0,0,.55);
    color:pink;
    font-size: var(--counterSize);
    box-shadow:0 0 18px rgba(255,105,180,.35);
    z-index:9998;
    display:none;
    backdrop-filter: blur(3px);
    white-space:nowrap;
    max-width: 92vw;
    overflow:hidden;
    text-overflow: ellipsis;
  }

  /* MENSAJE / BOTÃ“N AUDIO */
  #audioBar{
    position:fixed;
    top: calc(46px + var(--padSafeTop));
    left:50%;
    transform:translateX(-50%);
    z-index:9999;
    display:none;
    gap:8px;
    align-items:center;
    justify-content:center;
    max-width:92vw;
    flex-wrap:wrap;
  }
  #audioMsg{
    padding:8px 12px;
    border-radius:16px;
    background:rgba(0,0,0,.55);
    color:pink;
    font-size:13px;
    box-shadow:0 0 18px rgba(255,105,180,.35);
    backdrop-filter: blur(3px);
  }
  #audioBtn{
    padding:10px 14px;
    border-radius:16px;
    border:none;
    cursor:pointer;
    background:#ff69b4;
    color:white;
    box-shadow:0 0 18px rgba(255,105,180,.35);
    font-size:14px;
  }

  /* BOTÃ“N PRINCIPAL */
  #startBtn{
    position:fixed;
    top:50%;
    left:50%;
    transform:translate(-50%,-50%);
    padding:16px 28px;
    font-size:20px;
    background:#ff69b4;
    color:white;
    border:none;
    border-radius:22px;
    cursor:pointer;
    box-shadow:0 0 22px hotpink;
    z-index:10;
    animation:pulse 2s infinite;
  }
  @keyframes pulse{
    0%{transform:translate(-50%,-50%) scale(1)}
    50%{transform:translate(-50%,-50%) scale(1.06)}
    100%{transform:translate(-50%,-50%) scale(1)}
  }

  /* ORBITAS */
  .orbit{
    position:absolute;
    left:50%;
    top:50%;
    transform:translate(-50%,-50%);
    will-change: transform;
  }

  .floatingMedia{
    position:absolute;
    width: var(--mediaW);
    border-radius:16px;
    box-shadow:0 0 18px rgba(255,192,203,.85);
    transform:translate(-50%,-50%);
  }

  .floatingText{
    position:absolute;
    transform:translate(-50%,-50%);
    font-size: var(--textSize);
    color:pink;
    text-shadow:0 0 14px hotpink;
    white-space:nowrap;
    padding:8px 12px;
    border-radius:18px;
    background:rgba(0,0,0,.25);
    backdrop-filter: blur(3px);
    max-width: 80vw;
    overflow:hidden;
    text-overflow: ellipsis;
  }

  /* Ajuste extra para pantallas muy pequeÃ±as */
  @media (max-width: 380px){
    #startBtn{ font-size:18px; padding:14px 22px; }
    #audioBtn{ font-size:13px; }
  }
</style>
</head>

<body>
  <canvas id="heartsCanvas"></canvas>
  <canvas id="galaxy"></canvas>

  <div id="surpriseLayer"></div>

  <div id="loveCounter"></div>

  <div id="audioBar">
    <div id="audioMsg"></div>
    <button id="audioBtn">â–¶ Activar mÃºsica</button>
  </div>

  <button id="startBtn">ðŸ’– Toca baby ðŸ’•</button>

<script>
/* ====== Responsive iPhone-first: escala todo segÃºn pantalla ====== */
function applyPhoneScale(){
  const minSide = Math.min(window.innerWidth, window.innerHeight);
  // escala: iPhone tÃ­pico ~390-430. Tomamos base 430.
  const scale = Math.max(0.72, Math.min(1.0, minSide / 430));

  // tamaÃ±os (CSS variables)
  const mediaW = Math.round(110 * scale);          // fotos/videos
  const textSize = Math.round(18 * scale);         // frases
  const counterSize = Math.round(14 * scale);      // contador

  document.documentElement.style.setProperty("--mediaW", mediaW + "px");
  document.documentElement.style.setProperty("--textSize", textSize + "px");
  document.documentElement.style.setProperty("--counterSize", counterSize + "px");

  return scale;
}
let UI_SCALE = applyPhoneScale();
window.addEventListener("resize", ()=>{ UI_SCALE = applyPhoneScale(); });

/* ================= ðŸ’– CORAZONES DE FONDO ================= */
const heartsCanvas = document.getElementById("heartsCanvas");
const hctx = heartsCanvas.getContext("2d");

function resizeHearts(){
  heartsCanvas.width = innerWidth;
  heartsCanvas.height = innerHeight;
}
resizeHearts();
addEventListener("resize", resizeHearts);

const heartColors = ["#ff69b4", "#ff9ccc", "#ff4da6", "#ffd1e8"];
let hearts = [];
function initHearts(){
  const count = Math.round(130 * UI_SCALE); // menos para iPhone
  hearts = Array.from({length: count}, () => ({
    x: Math.random()*innerWidth,
    y: Math.random()*innerHeight,
    size: (7 + Math.random()*12) * UI_SCALE,
    alpha: 0.2 + Math.random()*0.8,
    alphaSpeed: (0.006 + Math.random()*0.012),
    driftX: (Math.random()*0.25 - 0.125) * UI_SCALE,
    driftY: (Math.random()*0.22 - 0.11) * UI_SCALE,
    color: heartColors[Math.floor(Math.random()*heartColors.length)]
  }));
}
initHearts();
addEventListener("resize", initHearts);

function drawHeart(x,y,s){
  hctx.beginPath();
  hctx.moveTo(x, y);
  hctx.bezierCurveTo(x - s, y - s, x - s*2, y + s, x, y + s*2);
  hctx.bezierCurveTo(x + s*2, y + s, x + s, y - s, x, y);
  hctx.closePath();
  hctx.fill();
}

function animateHearts(){
  hctx.clearRect(0,0,heartsCanvas.width,heartsCanvas.height);
  for (const h of hearts){
    h.alpha += h.alphaSpeed;
    if(h.alpha > 1 || h.alpha < 0.18) h.alphaSpeed *= -1;

    h.x += h.driftX; h.y += h.driftY;
    if(h.x < -50) h.x = innerWidth + 50;
    if(h.x > innerWidth + 50) h.x = -50;
    if(h.y < -50) h.y = innerHeight + 50;
    if(h.y > innerHeight + 50) h.y = -50;

    hctx.globalAlpha = h.alpha;
    hctx.shadowColor = h.color;
    hctx.shadowBlur = 14 * UI_SCALE;
    hctx.fillStyle = h.color;
    drawHeart(h.x, h.y, h.size);
  }
  hctx.shadowBlur = 0;
  hctx.globalAlpha = 1;
  requestAnimationFrame(animateHearts);
}
animateHearts();

/* ================= ðŸŒŒ GALAXIA ================= */
const galaxy = document.getElementById("galaxy");
const gctx = galaxy.getContext("2d");

function resizeGalaxy(){
  galaxy.width = innerWidth;
  galaxy.height = innerHeight;
}
resizeGalaxy();
addEventListener("resize", resizeGalaxy);

const starColors = ["#fff","#ff9ccc","#ff69b4","#ffb6c1","#ff4da6"];
let stars = [];
function initStars(){
  const count = Math.round(750 * UI_SCALE); // menos para iPhone
  stars = [];
  for(let i=0;i<count;i++){
    stars.push({
      a:Math.random()*Math.PI*2,
      r:Math.random()*(300*UI_SCALE + 120),
      s:0.0012+Math.random()*0.003,
      o:Math.random(),
      os:0.004+Math.random()*0.01,
      c:starColors[Math.floor(Math.random()*starColors.length)]
    });
  }
}
initStars();
addEventListener("resize", initStars);

function animateGalaxy(){
  gctx.clearRect(0,0,galaxy.width,galaxy.height);
  gctx.save();
  gctx.translate(galaxy.width/2, galaxy.height/2);

  for (const st of stars){
    st.a += st.s;
    st.o += st.os;
    if(st.o>1 || st.o<0) st.os *= -1;

    gctx.globalAlpha = st.o;
    gctx.fillStyle = st.c;
    gctx.beginPath();
    gctx.arc(Math.cos(st.a)*st.r, Math.sin(st.a)*st.r, 2*UI_SCALE, 0, Math.PI*2);
    gctx.fill();
  }

  gctx.restore();
  gctx.globalAlpha = 1;
  requestAnimationFrame(animateGalaxy);
}
animateGalaxy();

/* ================= ðŸŽµ AUDIO (Safari iPhone) ================= */
const audioBar = document.getElementById("audioBar");
const audioMsg = document.getElementById("audioMsg");
const audioBtn = document.getElementById("audioBtn");

function showAudioBar(msg){
  audioMsg.textContent = msg;
  audioBar.style.display = "flex";
}
function hideAudioBar(){ audioBar.style.display = "none"; }

const music = new Audio("./cancion.mp3");
music.loop = true;
music.preload = "auto";
music.volume = 0.85;

async function tryPlayMusic(){
  try{
    await music.play();
    hideAudioBar();
    return true;
  }catch(e){
    showAudioBar("ðŸ”‡ Safari bloqueÃ³ el audio. Presiona â–¶ Activar mÃºsica.");
    return false;
  }
}

audioBtn.onclick = () => { tryPlayMusic(); };

/* Aviso si el archivo no existe */
fetch("./cancion.mp3", { method:"HEAD" })
  .then(r => { if(!r.ok) showAudioBar("âŒ No se encuentra cancion.mp3 (revisa el nombre en GitHub)"); })
  .catch(()=> showAudioBar("âŒ No se pudo cargar cancion.mp3"));

/* ================= ðŸ’– CONTADOR ================= */
const loveCounter = document.getElementById("loveCounter");
const loveStart = new Date("June 20, 2024 00:00:00").getTime();

function updateLoveCounter(){
  const diff = Date.now() - loveStart;
  const d = Math.floor(diff / (1000*60*60*24));
  const h = Math.floor((diff / (1000*60*60)) % 24);
  const m = Math.floor((diff / (1000*60)) % 60);
  loveCounter.textContent = `Te he querido por ${d} dÃ­as, ${h}h ${m}m ðŸ’–`;
}

/* ================= ðŸ’– SORPRESA ORBITANDO (responsive) ================= */
const layer = document.getElementById("surpriseLayer");
const phrases = [
  "Te amo ranita ðŸ’–ðŸ¸",
  "Gracias por existir ðŸŒ¹",
  "Eres mi universo âœ¨",
  "Mi Diana hermosa ðŸ’ž",
  "Siempre juntos â¤ï¸",
  "Mi lugar favorito eres tÃº ðŸ’˜"
];

let orbiters = [];

function makeOrbit(node, r, s, a){
  const o = document.createElement("div");
  o.className = "orbit";
  o.dataset.r = r;
  o.dataset.s = s;
  o.dataset.a = a;
  o.appendChild(node);
  layer.appendChild(o);
  orbiters.push(o);
}

function orbitLoop(){
  const t = performance.now();
  const aspect = Math.min(0.8, window.innerHeight / window.innerWidth); // iPhone: Ã³rbita mÃ¡s compacta vertical
  for (const o of orbiters){
    const r = +o.dataset.r;
    const s = +o.dataset.s;
    const a = +o.dataset.a + t*s;
    const x = Math.cos(a) * r;
    const y = Math.sin(a) * (r * 0.62 * aspect);
    o.style.transform = `translate(-50%,-50%) translate(${x}px,${y}px)`;
  }
  requestAnimationFrame(orbitLoop);
}

function spawn(){
  // limpieza por si re-tocan
  layer.innerHTML = "";
  orbiters = [];

  // radios base adaptados al iPhone
  const minSide = Math.min(innerWidth, innerHeight);
  const baseR = Math.max(110, minSide * 0.23);
  const gapMedia = Math.max(70, minSide * 0.16);
  const gapText  = Math.max(48, minSide * 0.11);

  // FOTOS
  ["foto1.jpg","foto2.jpg"].forEach((src,i)=>{
    const img = document.createElement("img");
    img.src = src;
    img.className = "floatingMedia";
    makeOrbit(img, baseR + i*gapMedia, 0.00040 + i*0.00010, Math.random()*Math.PI*2);
  });

  // VIDEOS
  ["video1.mp4","video2.mp4"].forEach((src,i)=>{
    const v = document.createElement("video");
    v.src = src;
    v.autoplay = true;
    v.loop = true;
    v.muted = true;
    v.playsInline = true;
    v.className = "floatingMedia";
    makeOrbit(v, baseR + gapMedia*1.1 + i*gapMedia, 0.00030 + i*0.00010, Math.random()*Math.PI*2);
  });

  // FRASES (menos y mÃ¡s cortas en iPhone)
  const phraseCount = (minSide < 390) ? 4 : 5;
  for(let i=0;i<phraseCount;i++){
    const t = document.createElement("div");
    t.className = "floatingText";
    t.innerText = phrases[i % phrases.length];
    makeOrbit(t, baseR*0.85 + i*gapText, 0.00055 + i*0.00006, Math.random()*Math.PI*2);
  }

  orbitLoop();
}

/* ================= BOTÃ“N ================= */
const startBtn = document.getElementById("startBtn");
let counterTimer = null;

startBtn.onclick = async () => {
  // Intento de mÃºsica (si Safari bloquea, sale el botÃ³n extra)
  await tryPlayMusic();

  loveCounter.style.display = "block";
  updateLoveCounter();
  if (counterTimer) clearInterval(counterTimer);
  counterTimer = setInterval(updateLoveCounter, 60000);

  startBtn.style.display = "none";
  spawn();
};
</script>
</body>
</html>
